<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gráfico com Sinais</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }

    canvas {
      background: #1d1d1d;
      border: 1px solid #333;
      margin: 20px 0;
      border-radius: 10px;
      box-shadow: 0 0 10px #00f2ff44;
    }

    select {
      padding: 10px 15px;
      margin: 10px;
      background: #222;
      color: white;
      border: 1px solid #555;
      border-radius: 6px;
      font-size: 1rem;
    }

    #timer {
      font-size: 1.2rem;
      margin: 10px;
    }

    #historico {
      margin-top: 30px;
    }

    .win {
      color: #00ff00;
    }

    .loss {
      color: #ff4444;
    }
  </style>
</head>
<body>

  <h1>Gráfico de Sinais</h1>

  <div>
    <select id="moeda">
      <option value="BTC/USDT">BTC/USDT</option>
      <option value="ETH/USDT">ETH/USDT</option>
      <option value="EUR/USD">EUR/USD</option>
      <option value="GBP/USD">GBP/USD</option>
    </select>

    <select id="expiracao">
      <option value="60">Expiração: 1 Minuto</option>
    </select>

    <div id="timer">Próximo sinal em: 60s</div>
  </div>

  <canvas id="grafico" width="800" height="300"></canvas>

  <div id="historico">
    <h3>📜 Histórico de Sinais</h3>
    <ul id="listaHistorico" style="list-style: none; padding: 0;"></ul>
  </div>

  <script>
    const canvas = document.getElementById("grafico");
    const ctx = canvas.getContext("2d");
    const width = canvas.width;
    const height = canvas.height;
    let t = 0;

    function desenharGrafico() {
      ctx.clearRect(0, 0, width, height);
      ctx.beginPath();
      for (let x = 0; x < width; x++) {
        let y = height / 2 + Math.sin((x + t) * 0.03) * 40 + Math.sin((x + t) * 0.015) * 20;
        ctx.lineTo(x, y);
      }
      ctx.strokeStyle = "#00ffff";
      ctx.lineWidth = 2;
      ctx.stroke();
      t += 1.5;
      requestAnimationFrame(desenharGrafico);
    }
    desenharGrafico();

    // Timer de 60s
    let countdown = 60;
    const timerEl = document.getElementById("timer");
    let operacoes = 0;
    const lista = document.getElementById("listaHistorico");

    let ultimaOperacaoIndex = null; // Para guardar o índice da última operação COMPRA/VENDA

    function atualizarContador() {
      countdown--;
      if (countdown <= 0) {
        countdown = 60;
        gerarSinal(); // gera automaticamente
      }
      timerEl.textContent = `Próximo sinal em: ${countdown}s`;
    }

    function gerarSinal() {
      const opcoes = [
        "AINDA NÃO HÁ TENDÊNCIAS",
        "AGUARDANDO UMA OPORTUNIDADE",
        "COMPRA",
        "VENDA"
      ];

      // Aplica WIN/LOSS à última operação se for COMPRA ou VENDA
      if (ultimaOperacaoIndex !== null) {
        const li = lista.children[ultimaOperacaoIndex];
        const isWin = Math.random() < 0.8;
        const resultado = isWin ? " - WIN" : " - LOSS";
        const classe = isWin ? "win" : "loss";

        const span = document.createElement("span");
        span.className = classe;
        span.textContent = resultado;
        li.appendChild(span);

        ultimaOperacaoIndex = null;
      }

      const tipo = opcoes[Math.floor(Math.random() * opcoes.length)];
      operacoes++;
      const hora = new Date().toLocaleTimeString();

      const item = document.createElement("li");
      item.innerHTML = `<strong>${hora}</strong>: ${tipo}`;
      lista.insertBefore(item, lista.firstChild);

      // Se a operação for COMPRA ou VENDA e for depois da 3ª, guarda o índice para aplicar resultado no próximo ciclo
      if ((tipo === "COMPRA" || tipo === "VENDA") && operacoes > 3) {
        ultimaOperacaoIndex = 0; // sempre o primeiro da lista (inserido por último no topo)
      }
    }

    setInterval(atualizarContador, 1000);
  </script>

</body>
</html>
